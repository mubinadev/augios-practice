(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{151:function(t,e,o){"use strict";o.r(e),o.d(e,"default",(function(){return l}));var s=o(0),i=o(19);function a(t,e){for(var o=0;o<e.length;o++){var s=e[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var l=function(){function t(e){var o,s,i,a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.autocompliteNode=document.getElementById(e),this.input=this.autocompliteNode.querySelector(".autocomplete__input"),this.state={isLoading:!1,showResult:!1,haveResult:!1,userCan:!1},this.input&&(this.autocompleteSongs=[],this.autocompleteArtists=[],this.autocompleteCollections=[],this.autocompleteAlbums=[],this.result=this.autocompliteNode.querySelector(".autocomplete__result"),this.createResult=this.createResult.bind(this),this.form=this.autocompliteNode.querySelector(".autocomplete form"),this.form.onsubmit=function(t){t.preventDefault();var e="/search?q="+a.input.value;Turbolinks.visit(e,{action:"replace"})},this.input.onkeyup=(o=this.checkdata.bind(this),s=200,i=0,function(t){clearTimeout(i),i=setTimeout(o.bind(this,t.currentTarget),s||0)}),this.input.onfocus=this.focused.bind(this),this.input.onblur=this.blured.bind(this))}var e,o,l;return e=t,(o=[{key:"focused",value:function(){this.autocompliteNode.classList.add("autocomplete_long"),!0===this.state.haveResult&&this.result.classList.remove("autocomplete__result_hide")}},{key:"blured",value:function(){var t=this;this.autocompliteNode.classList.remove("autocomplete_long"),setTimeout((function(){t.result.classList.add("autocomplete__result_hide")}),300)}},{key:"checkdata",value:function(t){t.value.length>1&&this.sendData(t.value)}},{key:"sendData",value:function(t){var e=this,o=encodeURIComponent(t),i=Object(s.a)("GET"),a="/search_hints?q=".concat(o),l=o;fetch(a,i).then((function(t){return t.json()})).then((function(t){e.state.showResult=!0,e.state.haveResult=!0,"moderator"!==t.user_role&&"admin"!==t.user_role||(e.state.userCan=!0),e.autocompleteSongs=t.items.songs,e.autocompleteArtists=t.items.artists,e.autocompleteCollections=t.items.collections,e.autocompleteAlbums=t.items.albums,e.createResult(l)})).catch((function(t){e.state.showResult=!1,console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0444\u0435\u0442\u0447\u0430 \u043f\u043e\u0438\u0441\u043a\u0430",t)}))}},{key:"closeResult",value:function(){}},{key:"createResult",value:function(t){this.result.innerHTML="",this.autocompleteArtists.length||this.autocompleteSongs.length||this.autocompleteCollections.length||this.autocompleteAlbums?(this.prepareForRender(this.autocompleteCollections,t),this.prepareForRender(this.autocompleteArtists,t),this.prepareForRender(this.autocompleteSongs,t),this.prepareForRender(this.autocompleteAlbums,t)):this.result.innerHTML='<span style="padding:10px">\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e</span>',this.result.classList.remove("autocomplete__result_hide")}},{key:"prepareForRender",value:function(t,e){var o=this;t.forEach((function(t){var s=new RegExp(e,"i"),a=t.full_title.match(s);t.full_title=t.full_title.replace(a,"<b>".concat(a,"</b>"));var l=function(t,e,o,s){var a=Object(i.a)(t.image);if(t.accessible)return'\n  <a class="autocomplete-item" href="'.concat(e,'">\n  <img src="').concat(a,'" alt="\u0438\u043a\u043e\u043d\u043a\u0430" class="autocomplete-item__image">\n    <div class="autocomplete-item__info">\n      <div class="autocomplete-item__title">').concat(t.full_title,'</div>\n      <div class="autocomplete-item__subtitle">').concat(o,"</div>\n    </div>\n</a>");if(!t.accessible&&s){var l="/trkid/".concat(encodeURIComponent(t.id));return'\n  <a class="autocomplete-item autocomplete-item_blocked" href="'.concat(l,'">\n  <img src="').concat(a,'" alt="\u0438\u043a\u043e\u043d\u043a\u0430" class="autocomplete-item__image">\n    <div class="autocomplete-item__info">\n      <div class="autocomplete-item__title">').concat(t.full_title,'</div>\n      <div class="autocomplete-item__subtitle">').concat(o,"</div>\n\x3c!--      <span class='blocked' style='color: red; font-size: 8px'>\u0417\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d</span>--\x3e\n    </div>\n</a>")}}(t,t.url,o.computedSubtitle(t),o.state.userCan);l&&o.result.insertAdjacentHTML("beforeEnd",l)}))}},{key:"computedSubtitle",value:function(t){return"song"===t.resource?t.artist_title:"artist"===t.resource?"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c":"album"===t.resource?"\u0410\u043b\u044c\u0431\u043e\u043c":"\u0421\u0431\u043e\u0440\u043d\u0438\u043a"}}])&&a(e.prototype,o),l&&a(e,l),Object.defineProperty(e,"prototype",{writable:!1}),t}()}}]);